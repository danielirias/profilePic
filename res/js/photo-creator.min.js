var cropper;$("#btnOpenCam").click(function(){$("#modalWebcam").modal("show");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(stream){$("#webcam")[0].srcObject=stream;$("#webcam")[0].play()}).catch(function(err){console.log(err)})});$("#btnCloseCam").click(function(){$("#webcam")[0].srcObject.getTracks()[0].stop();$("#webcam")[0].pause()});$("#btnCapture").click(function(){var context=$("#webcamCanvas")[0].getContext("2d");$("#webcamCanvas")[0].width=$("#webcam")[0].videoWidth;$("#webcamCanvas")[0].height=$("#webcam")[0].videoHeight;context.drawImage($("#webcam")[0],0,0,$("#webcam")[0].videoWidth,$("#webcam")[0].videoHeight);$("#webcam")[0].srcObject.getTracks()[0].stop();$("#webcam")[0].pause();var imgData=$("#webcamCanvas")[0].toDataURL();saveImageToServer(imgData,"original")});function saveImageToServer(imgData,imgSize){var profileDNI="0801197902424";$.ajax({type:"POST",url:"photo-creator.php",data:{imageData:imgData,profileDNI:profileDNI,imgSize:imgSize},success:function(response){const fileToLoad=profileDNI+".jpg";openImageEditor(fileToLoad)},error:function(error){}})}function openImageEditor(fileToLoad){var date=new Date;var dateTime=date.toLocaleString().replace(/[.:]/g,"");$("#imgEditor").attr("src",fileToLoad+"?v="+dateTime);if(cropper){cropper.destroy()}const cropperWidth=150;const cropperHeight=150;cropper=new Cropper($("#imgEditor")[0],{aspectRatio:1,viewMode:1,responsive:true,autoCropArea:1,minCropBoxWidth:cropperWidth,minCropBoxHeight:cropperHeight,center:true,ready:function(){cropper.setCropBoxData({width:cropperWidth,height:cropperHeight,left:(cropper.getContainerData().width-cropperWidth)/2,top:(cropper.getContainerData().height-cropperHeight)/2})}});$("#modalWebcam").modal("hide");$("#modalEditor").modal("show")}$("#btnApply").click(function(){var croppedImageData=cropper.getCroppedCanvas().toDataURL("image/jpeg");saveImageToServer(croppedImageData,"thumb")});$("#btnFlipVertical").click(function(){cropper.scaleY(-cropper.getData().scaleY)});$("#btnFlipHorizontal").click(function(){cropper.scaleX(-cropper.getData().scaleX)});$("#btnRotateLeft").click(function(){cropper.rotate(-90)});$("#btnRotateRight").click(function(){cropper.rotate(90)});